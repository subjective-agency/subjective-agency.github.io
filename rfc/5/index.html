<!DOCTYPE html>
<html>

<head>
    <title>RFC-5. Pre-Launch Database Optimization - Wapaganda Project Docs</title>
    <style>
      /* load heading font */
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700');
      @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@700');

      /* load body font */
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:ital,wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:wght@700');
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:ital,wght@700');

      /* load mono font */
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:wght@400');
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:ital,wght@400');
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:wght@700');
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:ital,wght@700');

      /* load emoji font */
      @font-face {
        font-family: "Noto Color Emoji";
        src: url('../../assets/fonts/emoji/NotoColorEmoji-Regular.ttf');
        font-weight: 400;
      }
  
      :root {
        /* colors */
        --primary: #05b2dc;
        --secondary: #ef9B0f;
        --tertiary: #ef3e36;
        /* shades */
        --base: #ffffff;
        --mantle: #f5f4f5;
        --crust: #d4d2d5;
        --overlay: #aBaBaE;
        --footer: #000000cc;
        /* text */
        --text: #343233;
        --hltext: #ffffff;
        color: var(--text);
        /* background-specific text */
        --primary-text: var(--hltext);
        --secondary-text: var(--hltext);
        --tertiary-text: var(--hltext);
        --base-text: var(--text);
        --mantle-text: var(--text);
        --crust-text: var(--text);
        --overlay-text: var(--hltext);
        --footer-text: var(--hltext);
        /* fonts */
        --heading: Poppins, Noto Color Emoji;
        --body: Noto Sans, Noto Color Emoji;
        --mono: JetBrains Mono, Noto Color Emoji;
        font-family: var(--body); 
      }
      /* dark mode */
      @media (prefers-color-scheme: dark) {
        :root {
          /* colors */
          --primary: #05b2dc;
          --secondary: #ef9B0f;
          --tertiary: #ef3e36;
          /* shades */
          --base: #343233;
          --mantle: #373536;
          --crust: #3E3C3D;
          --overlay: #646461;
          --footer: #00000022;
          /* text */
          --text: #ffffff;
          --hltext: #343233;
          color: var(--text);
          /* background-specific text */
          --primary-text: var(--text);
          --secondary-text: var(--text);
          --tertiary-text: var(--text);
          --base-text: var(--text);
          --mantle-text: var(--text);
          --crust-text: var(--text);
          --overlay-text: var(--hltext);
          --footer-text: var(--text);
        }
      }
      /* style settings */
      header#header {
        grid-template-columns: 8rem auto 8rem;
      }
      body#background {
        background: fixed center/cover var(--base);
        
        
      }
      #background-gradient {
        background: linear-gradient(
          45deg, 
          color-mix(in srgb, var(--mantle) 80%, transparent), transparent, color-mix(in srgb, var(--crust) 20%, transparent)
        );
      }
      content#content {
        padding: 0 3rem;
        background: color-mix(in srgb, var(--base) 0%, transparent);
        border-left: none;
        border-right: none;
      }
      #avatar {
        
        border-radius: 1rem;
        
      }
      footer#footer a {
        color: #ef9B0f;
      }
      footer#footer a:hover {
        color: #ef3e36;
      }
    </style>
    <link rel="icon" type="image/x-icon" href=assets/landing-favicon.png>
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/responsivity.css" rel="stylesheet">  
    <script src="../../search/main.js"></script>
    <script src="https://kit.fontawesome.com/b57355f8ac.js" crossorigin="anonymous"></script>
    <script id="altmetric-embed-js" src="https://d1bxh8uas1mnw7.cloudfront.net/assets/altmetric_badges-e7ba41a192efc3e63f5d48f8a1916dec4b1b49c01075bc7b39481408957b3b28.js"></script>
    <link id="altmetric-embed-css" rel="stylesheet" type="text/css" href="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed-59614f5c46b49b21eeef3bb28c4fb38d1e7069e8d014752fcb66e84942556802.css">
  </head>

<body id="background">
  <div id="background-gradient"></div>
  <content id="content">
  
  <header id="article-header">
    <a href=../.. id="return-home">
        <i class="fa fa-arrow-left" alt="⇦"></i> Home
    </a>
    <h1 id="title">RFC-5. Pre-Launch Database Optimization</h1>
</header>
  
  <main id="page">
    <nav class="vertical" id="toc">

<ul>

<li class="nav-item">
<a href="#context">Context</a>
    
    <ul>
    
    </ul>
    
</li>

<li class="nav-item">
<a href="#decision">Decision</a>
    
    <ul>
    
    </ul>
    
</li>

<li class="nav-item">
<a href="#plan-of-action">Plan of action</a>
    
    <ul>
    
    </ul>
    
</li>

<li class="nav-item">
<a href="#status">Status</a>
    
    <ul>
    
    </ul>
    
</li>

<li class="nav-item">
<a href="#consequences">Consequences</a>
    
    <ul>
    
    </ul>
    
</li>

</ul>

</nav>
    <h2 id="context">Context</h2>
<p>The database schema has evolved quite significantly since it was conceived, and while its evolution was guided by performance considerations, certain initial decisions have led to suboptimal landscape and need to be re-evaluated now.</p>
<h2 id="decision">Decision</h2>
<p>A number of tables in the database contain various media episodes, and the current setup is ambiguous in the sense that there is no clear reasoning for why certain media segments would have their own dedicated tables, while others would be sharing.</p>
<p>To remove this ambiguity, a squashing operation should be implemented. Specifically, tables <code>60_minutes_vids</code>, <code>kto_protiv_vids</code>, <code>mkp_vids</code>, <code>solovyovlive_vids</code> (partially), <code>solovyovvecher_vids</code>, <code>typychny_vyshinsky_vids</code>, <code>vesti_vids</code>, <code>vestifm_episodes</code>, <code>radio_episodes</code> are to be merged into a single <code>smotrim_episodes</code> table; <code>besogon_vids</code>, <code>daytv_vids</code>, <code>komsomolskayapravda_vids</code>, <code>metametrica_vids</code> are to be merged into <code>youtube_vids</code>.</p>
<p>This would require modifications to the schema: both [new] tables are to be based off of the current templates, except to indicate the distinction that is upheld by different tables right now.</p>
<table>
<thead>
<tr>
<th>from</th>
<th>to</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>60_minutes_vids</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>kto_protiv_vids</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>mkp_vids</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>solovyovlive_vids</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>people_on_solovyovlive</code></td>
<td><code>people_on_smotrim</code></td>
</tr>
<tr>
<td><code>solovyovvecher_vids</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>~~people_on_solovyovvecher~~</code></td>
<td><code>people_on_smotrim</code></td>
</tr>
<tr>
<td><code>typychny_vyshinsky_vids</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>vesti_vids</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>vestifm_episodes</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>radio_episodes</code></td>
<td><code>smotrim_episodes</code></td>
</tr>
<tr>
<td><code>besogon_vids</code></td>
<td><code>youtube_vids</code></td>
</tr>
<tr>
<td><code>daytv_vids</code></td>
<td><code>youtube_vids</code></td>
</tr>
<tr>
<td><code>people_on_daytv</code></td>
<td><code>people_on_youtube</code></td>
</tr>
<tr>
<td><code>komsomolskayapravda_vids</code></td>
<td><code>youtube_vids</code></td>
</tr>
<tr>
<td><code>people_on_morning_mardan</code></td>
<td><code>people_on_youtube</code></td>
</tr>
<tr>
<td><code>metametrica_vids</code></td>
<td><code>youtube_vids</code></td>
</tr>
<tr>
<td><code>people_on_metametrica</code></td>
<td><code>people_on_youtube</code></td>
</tr>
</tbody>
</table>
<p>In addition:</p>
<ul>
<li><code>~~youtube_authors~~</code> ~~should be renamed~~ <code>~~people_on_youtube~~</code>~~; column to indicate role_id should be added to it.~~</li>
<li><strong>decide what to do with <code>youtube_authors</code> table</strong></li>
<li>MongoDB objects in the <code>transcripts</code> collection should be updated with new table name / id</li>
</ul>
<h2 id="plan-of-action">Plan of action</h2>
<p>The 1st part of the operation, the copying, should be completed over the course of 1 day, and the dropping should be done on the next day - this is so that we could have a backup of the complete DB, just in case. As an additional precaution measure, 2 index files, one per platform, should be saved with mapping <code>old_table</code>+<code>old_id</code> → <code>new_id</code>.</p>
<ul>
<li>[x] Create table <code>smotrim_episodes</code></li>
<li>[x] Copy contents of the smotrim tables to <code>smotrim_episodes</code> (except solovyolive_vids)</li>
<li>[x] Create table <code>people_on_smotrim</code></li>
<li>[x] Copy contents of the <code>solovyovlive_vids</code></li>
<li>[x] Copy contents of the <code>people_on_solovyovlive</code> also updating indices</li>
<li>[x] Create <code>people_on_youtube</code> table</li>
<li>[x] Copy contents of the youtube tables to <code>youtube_vids</code> also updating indices</li>
<li>[x] Update all scripts dealing with the deprecated tables to deal with the new set-up.</li>
<li>[x] Drop smotrim tables</li>
<li>[x] Drop youtube tables</li>
</ul>
<h2 id="status">Status</h2>
<p>In progress.</p>
<h2 id="consequences">Consequences</h2>
<p>This operation has a high potential for breaking things, so all the suggested changes must be listed first, with as much foresight into the specifics as possible, and should be applied after an internal discussion.</p>
    <nav id="page-controls">
      <a href="#content" id="return-top">
        <i class="fa fa-arrow-up" alt="⇧"></i> Return to top
      </a>
    </nav>
  </main>
  </content>
  <footer id="footer">
    

<p>Compiled from markdown using <a href="https://www.mkdocs.org/">MkDocs</a>. Theme is <a href="https://teparsons.github.io/mkdocs-landing/">Landing</a> by <a href="https://toddparsons.co.uk">Todd Parsons</a>.</p>














<script src="../../search/main.js"></script>

  </footer>
</body>

</html>